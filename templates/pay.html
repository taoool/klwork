<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>科隆智谷</title>
    <!-- jquery -->
    <script src="/static/js/jquery-3.2.1.min.js" type="text/javascript"></script>
    <!-- bootstrap -->
    <link href="/static/blog/bs/css/bootstrap.css" rel="stylesheet">
    <script src="/static/blog/bs/js/bootstrap.min.js" type="text/javascript"></script>
    <!-- bootstrap-select -->
    <link rel="stylesheet" href="/static/blog/bs/css/bootstrap-select.css">
    <script src="/static/blog/bs/js/bootstrap-select.min.js"></script>

    <style>
        .background {
            display: flex;
            margin-top: 60px;
        }

        .col-1 {
            font-size: 40px;
        }

        .col-2 {
            font-size: 30px;
        }

        .col-md-3 {
            width: 360px;
        }

        .col-md-9 {
            margin-top: 65px;
        }

        .table {
            font-size: 25px;

        }

        #add {
            font-size: 18px;
            margin-left: 911px;
        }

    </style>

</head>

<body>

<div class="background">

    <div class="col-md-3 ">
        <div class="col-1">导航栏</div>
        <div class="panel-body col-2">
            <ul>
                <li><a href="/customer_inf/">客户信息</a></li>
                <li><a href="/customer/">客户收款</a></li>
                <li><a href="/salesman/">业务员信息</a></li>
                <li><a href="/project/">支付项目</a></li>
                <li><a href="/commission/">提成</a></li>
                <li><a href="/finish/">付款记录</a></li>
                <li><a href="/department/">部门</a></li>
                <li><a href="/history/">导入记录</a></li>
            </ul>
        </div>
    </div>

    <div class="col-md-9">
        <div class="top-search">
            <form class="navbar-form navbar-left" method="POST">
                {% csrf_token %}

                <div class="form-group">
                    <input type="text" class="form-control" name="cus_name" placeholder="Search">
                </div>

                <button type="submit" class="btn btn-default">搜索</button>
            </form>
                <a href="/modify_commission/" class="btn btn-primary btn-lg active" id="add" role="button">新增</a>
        </div>

        <table class="table table-bordered">

            <thead>
            <tr>
                <th scope="col">序号</th>
                <th scope="col">客户</th>
                <th scope="col">联络人</th>
                <th scope="col">收款人</th>
                <form name="date">
                    <th scope="col">
                        <select name="year" onchange="selectYear(this.value)">
                            <option value="">
                                {% if year %}
                                    {{ year }}
                                {% else %}
                                    选择
                                {% endif %}
                                年</option>
                            <option value="">全部</option>

                        </select>
                    </th>

                    <th scope="col">
                        <select name="month" onchange="selectMonth(this.value)">
                            <option value="">
                                {% if month %}
                                    {{ month }}
                                {% else %}
                                    选择
                                {% endif %}
                                月</option>
                            <option value="">全部</option>
                        </select>
                    </th>
                </form>

                <th scope="col">金额</th>
                <th scope="col">操作</th>
            </tr>
            </thead>
            <tbody>

            {% for cus in ret %}
                <tr>
                    <th scope="row">{{ cus.id }}</th>
                    <td onclick="location.href='/commission/{{ cus.pay.customercol.customer.name }}/';"
                        style="cursor:pointer;">{{ cus.pay.customercol.customer.name }}</td>
                    <td>{{ cus.pay.customercol.name }}</td>
                    <td>{{ cus.pay.customercol.account_name }}</td>
                    <td>{{ cus.sales.time|date:"Y" }}</td>
                    <td>{{ cus.sales.time|date:"m" }}</td>
                    <td>{{ cus.total|floatformat:2 }}</td>
                    <td><a href="/modify_commission/{{ cus.id }}" class="btn btn-primary btn-lg active modify"
                           role="button">编辑</a>
                        <a href="/delete_commission/{{ cus.id }}" class="btn btn-primary btn-lg active delete"
                           role="button">删除</a></td>
                </tr>
            {% endfor %}
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>总额</td>
            <td>{{ tol|floatformat:2 }}</td>
            <td>待付</td>
            <td>{{ dss|add:mony|floatformat:2 }}</td>
            </tbody>

        </table>
    </div>


</div>

<script>
    var select = document.querySelector('select');
    //console.log('select',select);
    //console.log('window.location.pathname', window.location.pathname);
    //console.log('window.location', window.location);
    select.onchange = function () {

        window.location.href = window.location.origin + "/commission/" + this.value;
    };

    function selectMonth(date) {
        var select = document.querySelector('select');

        window.location.href = window.location.origin+ "/commission/" + {{ year }} + "/" + date
    }

    function dateStart() {

        //给年下拉框赋内容
        var y = new Date().getFullYear();
        for (var i = (y - 5); i < (y + 5); i++) {
            document.date.year.options.add(new Option(" " + i + " 年", i));
        }
        //给月下拉框赋内容
        var m = new Date().getMonth();
        //console.log('m',m);

        for (var i = 1;i < 13; i++){
            if (i < 10){
                i = '0' + i;
                document.date.month.options.add(new Option(" " + i + " 月", i))

            }else{
                document.date.month.options.add(new Option(" " + i + " 月", i))
            }
        }

    }

    if (document.attachEvent)
        window.attachEvent("onload", dateStart);
    else
        window.addEventListener('load', dateStart, false);

    function optionsClear(e) {
        e.options.length = 1;
    }
</script>


</body>

</html>